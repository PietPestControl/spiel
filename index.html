<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Sch√§dlings-Detektivspiel</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 2rem; }
    img { max-width: 100%; margin-bottom: 1rem; }
    .frage { margin: 1rem 0; }
    .versteckt { display: none; }
    .hinweis { color: orange; font-style: italic; }
    .erfolg { color: green; font-weight: bold; }
    .fehler { color: red; }
  </style>
</head>
<body>
  <h1>üîç Sch√§dlings-Detektivspiel</h1>
  <div id="bild"></div>
  <div class="frage" id="frage1"></div>
  <div class="frage versteckt" id="frage2"></div>
  <div class="frage versteckt" id="frage3"></div>
  <div class="frage versteckt" id="frage4"></div>
  <div id="hinweis" class="hinweis"></div>
  <div id="nachricht"></div>
  <button id="neustart" class="versteckt">üïµÔ∏è Neuer Fall</button>

  <script>
    let aktuellerFall = null;
    let schritte = 0;
    const hinweise = [
      "Tipp: Achte auf typische Merkmale im Bild.",
      "Tipp: Manche Arten leben verborgen oder nachtaktiv.",
      "Tipp: Wirkstoffk√∂der wirken bei Nagern besonders gut.",
      "Tipp: Bei Insekten helfen Spritzmittel oder K√∂dergel."
    ];

    let remainingFiles = ["faelle/deutschschabe.json", "faelle/hausmaus.json"];
    let usedFiles = [];

    function ladeFall() {
      if (remainingFiles.length === 0) {
        remainingFiles = usedFiles;
        usedFiles = [];
      }

      const zufallsIndex = Math.floor(Math.random() * remainingFiles.length);
      const datei = remainingFiles.splice(zufallsIndex, 1)[0];
      usedFiles.push(datei);

      fetch(datei)
        .then(res => res.json())
        .then(fall => {
          aktuellerFall = fall;
          schritte = 0;
          zeigeFall();
        });
    }

    function zeigeFall() {
      document.getElementById("bild").innerHTML = `<img src="${aktuellerFall.bild}" alt="Sch√§dlingsbild">`;
      document.getElementById("nachricht").innerText = "";
      document.getElementById("hinweis").innerText = hinweise[schritte] || "";

      zeigeFrage("frage1", aktuellerFall.fragen[0], 0);
    }

    function zeigeFrage(id, frageObjekt, nr) {
      const container = document.getElementById(id);
      container.classList.remove("versteckt");
      container.innerHTML = `<strong>${frageObjekt.frage}</strong><br>`;
      frageObjekt.optionen.forEach(opt => {
        const btn = document.createElement("button");
        btn.innerText = opt;
        btn.onclick = () => pr√ºfeAntwort(opt, nr);
        container.appendChild(btn);
      });
    }

    function pr√ºfeAntwort(antwort, nr) {
      const korrekt = aktuellerFall.fragen[nr].korrekt;
      if (antwort === korrekt) {
        schritte++;
        if (schritte < aktuellerFall.fragen.length) {
          document.getElementById(`frage${schritte}`).classList.remove("versteckt");
          document.getElementById("hinweis").innerText = hinweise[schritte] || "";
        } else {
          document.getElementById("nachricht").innerHTML = `<p class="erfolg">‚úÖ Fall gel√∂st! Gut gemacht!</p>`;
          document.getElementById("neustart").classList.remove("versteckt");
        }
      } else {
        document.getElementById("nachricht").innerHTML = `<p class="fehler">‚ùå Das war nicht korrekt. Versuch es erneut.</p>`;
      }
    }

    document.getElementById("neustart").onclick = () => {
      document.getElementById("frage1").classList.add("versteckt");
      document.getElementById("frage2").classList.add("versteckt");
      document.getElementById("frage3").classList.add("versteckt");
      document.getElementById("frage4").classList.add("versteckt");
      document.getElementById("neustart").classList.add("versteckt");
      ladeFall();
    };

    ladeFall();
  </script>
</body>
</html>
